/*! For license information please see rpldy-core.umd.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.rpldy=t():e.rpldy=t()}(self,(function(){return function(){var e,t={SKjz:function(e,t,n){"use strict";n.d(t,{uZ:function(){return A},ZP:function(){return R}});var r=n("P2gF"),o=(0,r.ZV)({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1});const a=(e,t)=>{if(!(0,r.mf)(e))throw new Error(`'${t}' is not a valid function`)},s=e=>void 0===e,i=Symbol.for("__le__"),c=Symbol.for("__le__pack__"),u=e=>e?e[i]:null,l=e=>{const t=u(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},d=e=>!!u(e),f=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];a(n,"cb");const o=l(e);if(!o.options.allowRegisterNonExistent&&!~o.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);const s=o.registry[t]||[];return s.find((e=>e.cb===n))||(s.push({name:t,cb:n,once:r}),o.registry[t]=s),()=>S.call(e,t,n)},p=(e,t)=>{const n=l(e).registry;return t?n[t]?n[t].slice():[]:Object.values(n).flat()},h={on:function(e,t){return f(this,e,t)},once:function(e,t){return f(this,e,t,!0)},off:S,getEvents:function(){return l(this).events.slice()}},g=()=>Object.entries(h).reduce(((e,t)=>{let[n,r]=t;return e[n]={value:r},e}),{}),m={trigger:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];const a=p(this,e);let i;if(a.length){var u;let t;1===n.length&&!0===(null===(u=n[0])||void 0===u?void 0:u[c])&&(t=n[0].resolve()),i=a.map((r=>{let o;return r.once&&v(this,e,r.cb),o=t?r.cb(...t):n.length?1===n.length?r.cb(n[0]):2===n.length?r.cb(n[0],n[1]):3===n.length?r.cb(n[0],n[1],n[2]):r.cb(...n):r.cb(),o})).filter((e=>!s(e))).map((e=>(0,r.tI)(e)?e:Promise.resolve(e)))}return i&&(i.length?i:void 0)},addEvent:function(e){const t=l(this);if(!t.options.canAddEvents)throw new Error("Cannot add new events (canAddEvents = false)");if(~t.events.indexOf(e))throw new Error(`Event '${e}' already defined`);t.events.push(e)},removeEvent:function(e){const t=l(this);if(!t.options.canRemoveEvents)throw new Error("Cannot remove events (canRemoveEvents = false)");{const n=t.events.indexOf(e);t.events.splice(n,1)}},hasEvent:function(e){return!!~l(this).events.indexOf(e)},hasEventRegistrations:function(e){return!!p(this,e).length},assign:function(e){const t=l(this);return y(e,t.options,t.events,t.registry,t.stats),b(e)}},b=e=>Object.keys(m).reduce(((t,n)=>(t[n]=m[n].bind(e),t)),{target:e,...m}),E=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=l(e).registry;!r[t]||!n&&r[t].length||delete r[t]},v=(e,t,n)=>{const r=l(e).registry;r[t]&&(n?(r[t]=r[t].filter((e=>e.cb!==n)),E(e,t)):E(e,t,!0))};function S(e,t){v(this,e,t)}const y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};Object.defineProperties(e,{[i]:{value:Object.seal({registry:r,events:n,options:t,stats:o})},...g()})};var R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;return e=e||{},n={...o,...n},d(e)||y(e,n,t),b(e)},A=e=>{const t={resolve:()=>[].concat(e())};return Object.defineProperty(t,c,{value:!0,configurable:!1}),t}},Vmq3:function(e,t,n){"use strict";n.d(t,{PF:function(){return a},Ch:function(){return o},ZP:function(){return p},KZ:function(){return d},lW:function(){return f}});var r=n("P2gF");const o="rpldy-sender";class a extends Error{constructor(e){super(`${e} didn't receive upload URL`),this.name="MissingUrlError"}}const s=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];"set"in e?e.set(t,...r):("delete"in e&&e.delete(t),e.append(t,...r))};const i=[200,201,202,203,204],c=(e,t,n,o,a)=>{let i;const c=null!=a&&a.getRequestData?a.getRequestData(e,n):((e,t)=>{let n;if(t.sendWithFormData)r.kg.debugLog(`uploady.sender: sending ${e.length} item(s) as form data`),n=((e,t)=>{const n=new FormData;return t.params&&Object.entries(t.params).forEach((e=>{let[r,o]=e;(t.formDataAllowUndefined||void 0!==o)&&s(n,r,o)})),((e,t,n)=>{const o=1===t.length;t.forEach(((t,a)=>{const i=o?n.paramName:(0,r.mf)(n.formatGroupParamName)?n.formatGroupParamName(a,n.paramName):`${n.paramName}[${a}]`;t.file?s(e,i,t.file,t.file.name):t.url&&s(e,i,t.url)}))})(n,e,t),n})(e,t);else{if(e.length>1)throw new Error(`XHR Sender - Request without form data can only contain 1 item. received ${e.length}`);const t=e[0];r.kg.debugLog(`uploady.sender: sending item ${t.id} as request body`),n=t.file||t.url}return n})(e,n),u=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,u=arguments.length>2?arguments[2]:void 0;u=(0,r.TS)({...(0,r.ei)(n,["method","headers","withCredentials"]),preSend:t=>{t.upload.onprogress=t=>{t.lengthComputable&&o&&o(t,e.slice())}}},u);const l=(0,r.WY)(a,s,u);return i=l.xhr,l},l=null!=a&&a.preRequestHandler?a.preRequestHandler(u,e,t,n,o,a):u();return{url:t,count:e.length,pXhr:l,getXhr:()=>i,aborted:!1}},u=(e,t,n)=>{let r=e;const o=null==t?void 0:t["content-type"];if(n.forceJsonResponse||null!=o&&o.includes("json"))try{r=JSON.parse(e)}catch{}return r},l=(e,t)=>e.pXhr.then((e=>(r.kg.debugLog("uploady.sender: received upload response ",e),((e,t)=>{const n=t.isSuccessfulCall?t.isSuccessfulCall(e):i.includes(e.status);return(0,r.tI)(n)?n:Promise.resolve(n)})(e,t).then((n=>{var o,a;const s=n?r.FD.FINISHED:r.FD.ERROR,i=e.status,c=(0,r.k7)(e);return{status:i,state:s,response:{data:null!==(o=null===(a=t.formatServerResponse)||void 0===a?void 0:a.call(t,e.response,i,c))&&void 0!==o?o:u(e.response,c,t),headers:c}}}))))).catch((t=>{let n,o;return e.aborted?(n=r.FD.ABORTED,o="aborted"):(r.kg.debugLog("uploady.sender: upload failed: ",t),n=r.FD.ERROR,o=t),{error:!0,state:n,response:o,status:0}}));var d=e=>(t,n,s,i)=>{if(!n)throw new a(o);r.kg.debugLog("uploady.sender: sending file: ",{items:t,url:n,options:s});const u=c(t,n,s,i,e);return{request:l(u,s),abort:()=>(e=>{let t=!1;const{aborted:n,getXhr:o}=e,a=o();return!n&&a&&a.readyState&&4!==a.readyState&&(r.kg.debugLog(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),a.abort(),e.aborted=!0,t=!0),t})(u),senderType:o}};const f=d();var p=f},P2gF:function(e,t,n){"use strict";n.d(t,{FG:function(){return u},FD:function(){return l},d9:function(){return k},Yc:function(){return O},ZV:function(){return N},D8:function(){return H},Ym:function(){return d},kG:function(){return a()},mf:function(){return P()},PO:function(){return B},yv:function(){return F()},tI:function(){return U},sQ:function(){return C},kg:function(){return r},TS:function(){return j},k7:function(){return I},ei:function(){return x},WY:function(){return T},P2:function(){return i()},tq:function(){return m},sc:function(){return E}});var r={};n.r(r),n.d(r,{debugLog:function(){return g},isDebugOn:function(){return p},setDebug:function(){return h}});var o=n("kvau"),a=n.n(o),s=n("uDTZ"),i=n.n(s);const c="__rpldy-logger-debug__",u={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted",ERROR:"error"},l={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"};var d=()=>"object"==typeof window&&!!window.document;let f;const p=()=>("boolean"!=typeof f&&(f=d()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||!0===window[c])),!!f),h=e=>{d()&&(window[c]=e),f=!!e||null},g=function(){p()&&console.log(...arguments)};var m=function(e,t){const n=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new Promise(((n,o)=>{const a=e(t,...r);a&&a.length?Promise.all(a).catch(o).then((e=>e&&n(!!~e.findIndex((e=>!1===e))))):n(!1)}))};for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return t?n(t,...o):n};const b=e=>null==e;var E=function(e,t){const n=function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new Promise(((n,o)=>{const a=e(t,...r);a&&a.length?Promise.all(a).catch(o).then((e=>{let t;if(e)for(;b(t)&&e.length;)t=e.pop();n(b(t)?void 0:t)})):n()}))};for(var r=arguments.length,o=new Array(r>2?r-2:0),a=2;a<r;a++)o[a-2]=arguments[a];return t?n(t,...o):n};const v=Symbol.for("__rpldy-bi__");let S=0;const y=(e,t)=>(e.url=t,e),R=(e,t)=>(e.file=t,e),A=e=>e&&(e instanceof File||e instanceof Blob||"object"==typeof e&&e.name&&e.type);var O=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];S+=e.id&&e.batchId?0:1;const r=e.id&&e.batchId?e.id:`${t}.item-${S}`,o=n?l.PENDING:l.ADDED;let a={id:r,batchId:t,state:o,uploadStatus:0,completed:0,loaded:0,recycled:!1,previousBatch:null};if(Object.defineProperty(a,v,{value:!0,writable:!0}),"object"==typeof e&&!0===e[v]&&(a.recycled=!0,a.previousBatch=e.batchId,e=e.file||e.url),"string"==typeof e)a=y(a,e);else{if(!A(e))throw new Error("Unknown type of file added: "+typeof e);a=R(a,e)}return a};const D=(e,t)=>{t&&Object.keys(t).forEach((n=>{void 0!==t[n]&&e.setRequestHeader(n,t[n])}))};var I=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce(((e,t)=>{const[n,r]=t.split(": ");return e[n]=r,e}),{})}catch(t){g("uploady.request: failed to read response headers",e)}return t},T=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new XMLHttpRequest,o=new Promise(((o,a)=>{r.onerror=()=>a(r),r.ontimeout=()=>a(r),r.onabort=()=>a(r),r.onload=()=>o(r),r.open(n.method||"GET",e),D(r,n.headers),r.withCredentials=!!n.withCredentials,n.preSend&&n.preSend(r),r.send(t)}));return o.xhr=r,o},w=n("wfJ/"),P=n.n(w),C=(e,t,n)=>{let r=!0;const o=(e=>{const t=[].concat(e);return e=>e.map((e=>t.map((t=>e[t])).join()))})(n);if(e&&t&&e.length===t.length){const n=o(e),a=o(t);r=!!n.find(((e,t)=>e!==a[t]))}return!r},_=n("hSSe"),F=n.n(_),N=e=>F()()?e:Object.freeze(e),B=e=>{var t;return!!e&&"object"==typeof e&&("Object"===(null===(t=Object.getPrototypeOf(e))||void 0===t?void 0:t.constructor.name)||null===Object.getPrototypeOf(e))};const L=e=>B(e)||Array.isArray(e),G=(e,t)=>{const n=Object.keys(e);return t.withSymbols?n.concat(Object.getOwnPropertySymbols(e)):n},H=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return n&&o.length&&o.forEach((r=>{r&&G(r,e).forEach((o=>{const a=r[o];e.predicate&&!e.predicate(o,a)||(void 0!==a||e.undefinedOverwrites)&&(L(a)?(void 0!==n[o]&&B(n[o])||(n[o]=Array.isArray(a)?[]:{}),t(n[o],a)):n[o]=a)}))})),n};return t};var j=H(),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j;return L(e)?t(Array.isArray(e)?[]:{},e):e},x=(e,t)=>e&&Object.keys(e).reduce(((n,r)=>(~t.indexOf(r)&&(n[r]=e[r]),n)),{}),U=e=>!!e&&"object"==typeof e&&"function"==typeof e.then},"wfJ/":function(e){e.exports=function(e){return"function"==typeof e}},hSSe:function(e){e.exports=function(){return!0}},"1P8H":function(e,t,n){"use strict";n.r(t),n.d(t,{BATCH_STATES:function(){return o.FG},DEFAULT_OPTIONS:function(){return Y},FILE_STATES:function(){return o.FD},MissingUrlError:function(){return Q.PF},UPLOADER_EVENTS:function(){return h},XHR_SENDER_TYPE:function(){return Q.Ch},composeEnhancers:function(){return re},createUploader:function(){return ne},default:function(){return oe},getXhrSend:function(){return Q.KZ},send:function(){return Q.lW}});var r=n("SKjz"),o=n("P2gF");const a=Symbol.for("__rpldy-sstt-proxy__"),s=Symbol.for("__rpldy-sstt-state__"),i=e=>!(0,o.yv)()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(a),c=e=>Array.isArray(e)||(0,o.PO)(e)&&!(e=>(0,o.Ym)()&&e instanceof File||e.name&&e.size&&e.uri)(e),u=(0,o.D8)({withSymbols:!0,predicate:e=>e!==a&&e!==s}),l=e=>!!(0,o.yv)()||e[s].isUpdateable,d=(e,t)=>{(0,o.yv)()||(e[s].isUpdateable=t)},f=(e,t)=>{let n;return c(e)&&(i(e)||(e[a]=!0,n=new Proxy(e,t)),Object.keys(e).forEach((n=>{e[n]=f(e[n],t)}))),n||e},p=e=>i(e)?(0,o.d9)(e,u):e;const h=(0,o.ZV)({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",BATCH_ERROR:"BATCH-ERROR",BATCH_FINALIZE:"BATCH-FINALIZE",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),g=(0,o.ZV)({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),m=[o.FD.FINISHED,o.FD.ERROR,o.FD.CANCELLED,o.FD.ABORTED],b=(0,o.D8)({undefinedOverwrites:!0}),E=(e,t,n,r,a,s)=>{const i=n(t),c=e.getState().batches[i[0].batchId].batchOptions,u=(null==r?void 0:r(t,c))||t;return((e,t,n,r,a,s)=>(0,o.sc)(e.trigger,a,t,r).then((e=>(null==s||s(e),((e,t,n,r)=>{if(r){if(o.kg.debugLog(`uploader.queue: REQUEST_PRE_SEND(${e}) event returned updated items/options`,r),r.items){if(r.items.length!==t.length||!(0,o.sQ)(r.items,t,["id","batchId","recycled"]))throw new Error(`REQUEST_PRE_SEND(${e}) event handlers must return same items with same ids`);t=r.items}r.options&&(n=b({},n,r.options))}return{items:t,options:n,cancelled:!1===r}})(a,n,r,e)))))(e,u,i,c,s,a).then((t=>(t.cancelled||((e,t)=>{e.updateState((e=>{t.items.forEach((t=>{e.items[t.id]=t})),e.batches[t.items[0].batchId].batchOptions=t.options}));const n=e.getState();t.items=t.items.map((e=>n.items[e.id])),t.options=n.batches[t.items[0].batchId].batchOptions})(e,t),t)))},v=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(o,a)=>E(o,a,t,n,r,e)},S=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.getState(),o=r.itemQueue.indexOf(t);~o&&e.updateState((e=>{n&&delete e.items[t],e.itemQueue.splice(o,1);const r=e.activeIds.indexOf(t);~r&&e.activeIds.splice(r,1)}))},y=(e,t,n)=>e.getState().items[t].batchId===n,R=v(h.BATCH_START,(e=>e.items),null,(function(){let{batch:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e)throw new Error("BATCH_START event handlers cannot update batch data. Only items & options")})),A=[o.FG.ADDED,o.FG.PROCESSING,o.FG.UPLOADING],O=[o.FG.ABORTED,o.FG.CANCELLED,o.FG.FINISHED,o.FG.ERROR],D=(e,t)=>e.batches[t].batch,I=(e,t)=>{const n=e.getState(),r=n.items[t];return n.batches[r.batchId]},T=(e,t)=>I(e,t).batch,w=(e,t)=>{const n=((e,t)=>D(e.getState(),t))(e,t);n.items.forEach((t=>{let{id:n}=t;return S(e,n,!0)}))},P=(e,t)=>{e.updateState((e=>{delete e.batches[t]}))},C=(e,t,n)=>{_(e,t,n),_(e,t,h.BATCH_FINALIZE)},_=(e,t,n)=>{const r=e.getState(),o=D(r,t),a=r.items,s={...p(o),items:o.items.map((e=>{let{id:t}=e;return p(a[t])}))};e.trigger(n,s)},F=(e,t)=>{const n=T(e,t);return A.includes(n.state)},N=e=>O.includes(e.state),B={[o.FD.PENDING]:null,[o.FD.ADDED]:h.ITEM_START,[o.FD.FINISHED]:h.ITEM_FINISH,[o.FD.ERROR]:h.ITEM_ERROR,[o.FD.CANCELLED]:h.ITEM_CANCEL,[o.FD.ABORTED]:h.ITEM_ABORT,[o.FD.UPLOADING]:h.ITEM_PROGRESS},L=e=>!!~m.indexOf(e.state);var G=(e,t,n)=>{t.forEach((t=>{const n=e.getState(),{id:r,info:a}=t;if(o.kg.debugLog("uploader.processor.queue: request finished for item - ",{id:r,info:a}),n.items[r]){e.updateState((e=>{const t=e.items[r];t.state=a.state,t.uploadResponse=a.response,t.uploadStatus=a.status,L(t)&&delete e.aborts[r]}));const t=e.getState().items[r];a.state===o.FD.FINISHED&&t.completed<100&&e.handleItemProgress(t,100,t.file?t.file.size:0),B[t.state]&&e.trigger(B[t.state],t),L(t)&&(((e,t)=>{e.updateState((e=>{e.batches[t].finishedCounter+=1}))})(e,t.batchId),e.trigger(h.ITEM_FINALIZE,t))}S(e,r)})),(e=>{const t=e.getState();Object.keys(t.batches).forEach((n=>{const{batch:r,finishedCounter:a}=t.batches[n],{orgItemCount:s}=r,i=N(r);s===a&&(i||100===r.completed||(e.updateState((e=>{const t=D(e,n);t.completed=100,t.loaded=t.items.reduce(((e,t)=>{let{loaded:n}=t;return e+n}),0)})),_(e,n,h.BATCH_PROGRESS)),e.updateState((e=>{const t=D(e,n);t.state=i?t.state:o.FG.FINISHED,e.currentBatch===n&&(e.currentBatch=null)})),o.kg.debugLog(`uploady.uploader.batchHelpers: cleaning up batch: ${r.id}`),i||C(e,n,h.BATCH_FINISH),w(e,n),P(e,n))}))})(e),n(e)};const H=v(h.REQUEST_PRE_SEND,(e=>e),((e,t)=>({items:e,options:t}))),j=e=>{let{allowedItems:t,cancelledResults:n,queue:r,items:a,ids:s,next:i}=e;return(t.length?H(r,t):Promise.resolve()).catch((e=>{o.kg.debugLog("uploader.queue: encountered error while preparing items for request",e),((e,t,n,r)=>{const a=n.map((t=>{let{id:n}=t;return{id:n,info:{status:0,state:o.FD.ERROR,response:e}}}));G(t,a,r)})(e,r,a,i)})).then((e=>{let t;return e&&(e.cancelled?n=s.map((()=>!0)):((e,t,n)=>{const{items:r,options:a}=t,s=e.getState().batches[r[0].batchId].batch;let i;try{i=e.sender.send(r,s,a)}catch(e){o.kg.debugLog("uploader.queue: sender failed with unexpected error",e),i={request:Promise.resolve({status:0,state:o.FD.ERROR,response:e.message}),abort:()=>!1,senderType:"exception-handler"}}const{request:c}=i;((e,t,n)=>{e.updateState((e=>{t.forEach((t=>{e.items[t.id].state=o.FD.UPLOADING,e.aborts[t.id]=n.abort}))}))})(e,r,i),c.then((t=>{const o=r.map((e=>({id:e.id,info:t})));G(e,o,n)}))})(r,{items:e.items,options:e.options},i)),((e,t,n,r)=>{const a=n.map(((e,n)=>e?t[n].id:null)).filter(Boolean);if(a.length){const t=a.map((e=>({id:e,info:{status:0,state:o.FD.CANCELLED,response:"cancel"}})));G(e,t,r)}return!!a.length})(r,a,n,i)||(t=i(r)),t}))};const k=(e,t)=>e.getState().activeIds.flat().includes(t),x=e=>{let t;const n=(e=>{const t=e.getState().itemQueue,n=(e=>{const t=e.getState(),n=t.itemQueue,r=t.items;let a=0,s=n[a];for(;s&&(k(e,s)||!F(e,s)||r[s].state!==o.FD.ADDED);)a+=1,s=n[a];return s?a:-1})(e);let r,a=t[n];if(a){const o=I(e,a),s=o.batch.id,i=o.batchOptions.maxGroupSize||0;if(o.batchOptions.grouped&&i>1){r=[];let o=!0;for(;r.length<i&&o;)r.push(a),a=t[n+r.length],o=a&&y(e,a,s)}else r=[a]}return r})(e);if(n){const r=e.getCurrentActiveCount(),{concurrent:a=0,maxConcurrent:s=0}=e.getOptions();(!r||a&&r<s)&&(o.kg.debugLog("uploader.processor: Processing next upload - ",{ids:n,currentCount:r}),t=((e,t)=>{let n;return((e,t)=>{e.updateState((e=>{e.activeIds=e.activeIds.concat(t)}))})(e,t),n=((e,t)=>{const n=T(e,t);return e.getState().currentBatch!==n.id})(e,t[0])?((e,t)=>{const n=T(e,t);return R(e,n).then((t=>{let{cancelled:r}=t;return r||e.updateState((e=>{e.currentBatch=n.id})),!r}))})(e,t[0]).then((n=>{let r=!n;return r&&(((e,t)=>{const n=T(e,t),r=n.id;o.kg.debugLog("uploady.uploader.batchHelpers: cancelling batch: ",{batch:n}),e.updateState((e=>{D(e,r).state=o.FG.CANCELLED})),C(e,r,h.BATCH_CANCEL),w(e,r),P(e,r)})(e,t[0]),x(e)),r})).catch((n=>(o.kg.debugLog("uploader.processor: encountered error while preparing batch for request",n),((e,t,n)=>{const r=T(e,t),a=r.id;o.kg.debugLog("uploady.uploader.batchHelpers: failing batch: ",{batch:r}),e.updateState((e=>{const t=D(e,a);t.state=o.FG.ERROR,t.additionalInfo=n.message})),C(e,a,h.BATCH_ERROR),w(e,a),P(e,a)})(e,t[0],n),x(e),!0))):Promise.resolve(!1),n})(e,n).then((t=>{t||(((e,t,n)=>{const r=e.getState();let o=Object.values(r.items);o=o.filter((e=>!!~t.indexOf(e.id))),Promise.all(o.map((t=>e.runCancellable(h.ITEM_START,t)))).then((r=>{let a=r.map(((t,n)=>t?null:((e,t)=>{const n=t.getState().items[e];return n&&!m.includes(n.state)?n:void 0})(o[n].id,e))).filter(Boolean);return{allowedItems:a,cancelledResults:r,queue:e,items:o,ids:t,next:n}})).then(j)})(e,n,x),a&&x(e))})))}return t};var U=x;const q=(e,t,n)=>(o.kg.debugLog(`uploader.queue: aborting ${t.state} item  - `,t),G(e,[{id:t.id,info:{status:0,state:o.FD.ABORTED,response:"aborted"}}],n),!0),$={[o.FD.UPLOADING]:(e,t)=>(o.kg.debugLog("uploader.queue: aborting uploading item  - ",t),e.getState().aborts[t.id]()),[o.FD.ADDED]:q,[o.FD.PENDING]:q},M=(e,t,n)=>{const r=e.getState().items[t],o=null==r?void 0:r.state;return!!$[o]&&$[o](e,r,n)};var Z=(e,t,n,r,c)=>{const{state:u,update:m}=(e=>{const t={set:(e,r,o)=>(l(n)&&(e[r]=f(o,t)),!0),get:(e,t)=>t===a?p(e):e[t],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(e,t)=>(l(n)&&delete e[t],!0)};(0,o.yv)()||i(e)||Object.defineProperty(e,s,{value:{isUpdateable:!1},configurable:!0});const n=(0,o.yv)()?e:f(e,t);return{state:n,update:e=>{if(!(0,o.yv)()&&l(n))throw new Error("Can't call update on State already being updated!");try{d(n,!0),e(n)}finally{d(n,!1)}return n},unwrap:e=>e?p(e):i(n)?p(n):n}})({itemQueue:[],currentBatch:null,batches:{},items:{},activeIds:[],aborts:{}}),b=()=>u,E=e=>{m(e)},v=e=>{if(u.items[e.id]&&!e.recycled)throw new Error(`Uploader queue conflict - item ${e.id} already exists`);e.recycled&&((e,t)=>{const{previousBatch:n}=t;if(t.recycled&&n&&e.getState().batches[n]){const{id:r}=T(e,t.id);r===n&&e.updateState((e=>{const n=D(e,r),o=n.items.findIndex((e=>{let{id:n}=e;return n===t.id}));~o&&n.items.splice(o,1)}))}})(y,e),E((t=>{t.items[e.id]=e,t.itemQueue.push(e.id)}))},S=(e,n,r)=>{u.items[e.id]&&(E((t=>{const o=t.items[e.id];o.loaded=r,o.completed=n})),t(h.ITEM_PROGRESS,b().items[e.id]))};r.on(g.ITEM_PROGRESS,S),r.on(g.BATCH_PROGRESS,(e=>{var n;const r=null===(n=u.batches[e.id])||void 0===n?void 0:n.batch.items;if(r){const[n,o]=r.reduce(((e,t)=>{let{id:n}=t;const{completed:r,loaded:o}=u.items[n];return e[0]+=r,e[1]+=o,e}),[0,0]);E((t=>{const a=t.batches[e.id].batch;a.completed=n/r.length,a.loaded=o})),t(h.BATCH_PROGRESS,u.batches[e.id].batch)}}));const y={uploaderId:c,getOptions:()=>e,getCurrentActiveCount:()=>u.activeIds.length,getState:b,updateState:E,trigger:t,runCancellable:function(e){if(!(0,o.mf)(n))throw new Error("Uploader queue - cancellable is of wrong type");for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return n(e,...r)},sender:r,handleItemProgress:S};return(0,o.Ym)()&&o.kg.isDebugOn()&&(window[`__rpldy_${c}_queue_state`]=y),{updateState:E,getState:y.getState,runCancellable:y.runCancellable,uploadBatch:(e,t)=>{t&&E((n=>{n.batches[e.id].batchOptions=t})),U(y)},addBatch:(e,t)=>(E((n=>{n.batches[e.id]={batch:e,batchOptions:t,finishedCounter:0}})),e.items.forEach(v),D(u,e.id)),abortItem:e=>((e,t,n)=>M(e,t,n))(y,e,U),abortBatch:e=>{((e,t,n)=>{const r=e.getState().batches[t],a=null==r?void 0:r.batch;a&&!N(a)&&(e.updateState((e=>{D(e,t).state=o.FG.ABORTED})),_(e,t,h.BATCH_ABORT),a.items.forEach((t=>M(e,t.id,n))))})(y,e,U)},abortAll:()=>{((e,t)=>{const n=e.getState().items;Object.keys(n).forEach((n=>M(e,n,t))),e.trigger(h.ALL_ABORT)})(y,U)},clearPendingBatches:()=>{(e=>{const t=e.getState().batches;Object.keys(t).filter((e=>t[e].batch.state===o.FG.PENDING)).forEach((t=>{w(e,t),P(e,t)}))})(y)},uploadPendingBatches:e=>{((e,t)=>{e.updateState((e=>{Object.keys(e.batches).forEach((n=>{const r=e.batches[n],{batch:a,batchOptions:s}=r;a.state===o.FG.PENDING&&(a.items.forEach((e=>{e.state=o.FD.ADDED})),a.state=o.FG.ADDED,r.batchOptions=(0,o.TS)({},s,t))}))}))})(y,e),U(y)}}},Q=n("Vmq3");const V=()=>!0,Y=(0,o.ZV)({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:V,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0,formDataAllowUndefined:!1});var z=()=>{const{trigger:e,target:t}=(0,r.ZP)({send:(t,n,r)=>{const a=r.destination,s=null==a?void 0:a.url,i=(0,o.P2)((r=>((e,t,n,r)=>{((e,t,n,r)=>{e.forEach((e=>{o.kg.debugLog(`uploady.uploader.processor: file: ${e.id} progress event: loaded(${n}) - completed(${t})`),r(g.ITEM_PROGRESS,e,t,n)}))})(e,Math.min(n.loaded/n.total*100,100)/e.length,n.loaded/e.length,r),r(g.BATCH_PROGRESS,t)})(t,n,r,e)),50,!0);return((0,o.mf)(r.send)?r.send:Q.ZP)(t,s,{method:(null==a?void 0:a.method)||r.method||Y.method,paramName:(null==a?void 0:a.filesParamName)||r.inputFieldName||"file",params:{...r.params,...null==a?void 0:a.params},forceJsonResponse:r.forceJsonResponse,withCredentials:r.withCredentials,formatGroupParamName:r.formatGroupParamName,headers:null==a?void 0:a.headers,sendWithFormData:r.sendWithFormData,formatServerResponse:r.formatServerResponse,formDataAllowUndefined:r.formDataAllowUndefined,isSuccessfulCall:r.isSuccessfulCall},i)}},Object.values(g));return t};const W=(0,o.Ym)()&&"FileList"in window,X=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e;return(0,o.yv)()||(t<3&&i(e)?n=p(e):t<3&&c(e)&&(n=Array.isArray(e)?e.map((e=>X(e,t+1))):Object.keys(e).reduce(((n,r)=>(n[r]=X(e[r],t+1),n)),{}))),n};let J=0;var K=(e,t,n,r)=>{const a=z(),s=Z(n,e,t,a,r);return{process:(e,t)=>{s.uploadBatch(e,t)},abortBatch:e=>{s.abortBatch(e)},abort:e=>{e?s.abortItem(e):s.abortAll()},addNewBatch:(e,t,n)=>((e,t,n)=>{J+=1;const r=`batch-${J}`,a=(e=>W&&e instanceof FileList||"[object FileList]"===e.toString())(e);e=Array.isArray(e)||a?e:[e];const s=!n.autoUpload;return((e,t,n,r)=>Promise.all(Array.prototype.map.call(t,(e=>{const t=(r||V)(e);return(0,o.tI)(t)?t.then((t=>!!t&&e)):!!t&&e}))).then((t=>t.filter(Boolean).map((t=>(0,o.Yc)(t,e,n))))))(r,e,s,n.fileFilter).then((e=>({id:r,uploaderId:t,items:e,state:s?o.FG.PENDING:o.FG.ADDED,completed:0,loaded:0,orgItemCount:e.length,additionalInfo:null})))})(e,t,n).then((e=>s.addBatch(e,n))),runCancellable:s.runCancellable,clearPendingBatches:()=>{s.clearPendingBatches()},processPendingBatches:e=>{s.uploadPendingBatches(e)}}};const ee=Object.values(h);let te=0;var ne=e=>{te+=1;const t=`uploader-${te}`;let n=!1;const a={};o.kg.debugLog(`uploady.uploader: creating new instance (${t})`,{options:e,counter:te});let s=(e=>{return{...Y,...e,destination:e&&e.destination?(t=e.destination,{params:{},...t}):null};var t})(e);const i=()=>{f.clearPendingBatches()};let{trigger:c,target:u}=(0,r.ZP)({id:t,update:e=>(s=(0,o.TS)({},s,e),u),add:(e,t)=>{const n=(0,o.TS)({},s,t);return n.clearPendingOnAdd&&i(),f.addNewBatch(e,u.id,n).then((e=>{let t;return e.items.length?t=f.runCancellable(h.BATCH_ADD,e,n).then((t=>{t?(e.state=o.FG.CANCELLED,l(h.BATCH_CANCEL,e)):(o.kg.debugLog(`uploady.uploader [${u.id}]: new items added - auto upload =\n                        ${String(n.autoUpload)}`,e.items),n.autoUpload&&f.process(e))})):o.kg.debugLog(`uploady.uploader: no items to add. batch ${e.id} is empty. check fileFilter if this isn't intended`),t}))},upload:e=>{f.processPendingBatches(e)},abort:e=>{f.abort(e)},abortBatch:e=>{f.abortBatch(e)},getOptions:()=>(0,o.d9)(s),clearPending:i,registerExtension:(e,t)=>{(0,o.kG)(n,"Uploady - uploader extensions can only be registered by enhancers"),(0,o.kG)(!a[e],"Uploady - uploader extension by this name [%s] already exists",e),o.kg.debugLog(`uploady.uploader: registering extension: ${e.toString()}`,t),a[e]=t},getExtension:e=>a[e]},ee,{canAddEvents:!1,canRemoveEvents:!1});const l=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];const a=(0,r.uZ)((()=>n.map(X)));return c(e,a)},d=(0,o.tq)(l);if(s.enhancer){n=!0;const e=s.enhancer(u,l);n=!1,u=e||u}const f=K(l,d,s,u.id);return(0,o.ZV)(u)},re=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return t.reduce(((e,t)=>t(e,...r)||e),e)}},oe=ne}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=function(t,n,o,a){if(!n){var s=1/0;for(l=0;l<e.length;l++){n=e[l][0],o=e[l][1],a=e[l][2];for(var i=!0,c=0;c<n.length;c++)(!1&a||s>=a)&&Object.keys(r.O).every((function(e){return r.O[e](n[c])}))?n.splice(c--,1):(i=!1,a<s&&(s=a));if(i){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={321:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,a,s=n[0],i=n[1],c=n[2],u=0;if(s.some((function(t){return 0!==e[t]}))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(c)var l=c(r)}for(t&&t(n);u<s.length;u++)a=s[u],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=self.webpackChunkrpldy=self.webpackChunkrpldy||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}(),r.O(void 0,[429],(function(){return r("SKjz")})),r.O(void 0,[429],(function(){return r("P2gF")})),r.O(void 0,[429],(function(){return r("Vmq3")}));var o=r.O(void 0,[429],(function(){return r("1P8H")}));return r.O(o)}()}));
//# sourceMappingURL=rpldy-core.umd.min.js.map